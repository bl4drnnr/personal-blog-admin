<div class="html-editor-container">
  <div class="editor-header">
    <label class="editor-label">{{ label }}</label>
    <div class="editor-controls">
      <button
        type="button"
        class="view-toggle-btn"
        [class.active]="!showHtmlSource"
        (click)="showHtmlSource = false"
      >
        Visual
      </button>
      <button
        type="button"
        class="view-toggle-btn"
        [class.active]="showHtmlSource"
        (click)="showHtmlSource = true"
      >
        HTML
      </button>
    </div>
  </div>

  <div class="editor-content" [class.split-view]="showPreview && !showHtmlSource">
    <!-- Visual Editor -->
    <div class="editor-panel" *ngIf="!showHtmlSource">
      <div class="ngx-editor-wrapper">
        <ngx-editor-menu [editor]="editor" [toolbar]="toolbar"></ngx-editor-menu>
        <div class="custom-toolbar">
          <button 
            type="button" 
            class="table-btn"
            (click)="openTableEditor()"
            [disabled]="disabled"
            title="Insert Table"
          >
            📊 Insert Table
          </button>
        </div>
        
        <!-- Table History Panel -->
        <div class="table-history-panel" *ngIf="getTables().length > 0">
          <details>
            <summary>📋 Manage Tables ({{ getTables().length }})</summary>
            <div class="tables-list">
              <div 
                *ngFor="let table of getTables(); let i = index" 
                class="table-item"
              >
                <div class="table-info">
                  <span class="table-name">Table {{ i + 1 }}</span>
                  <span class="table-details">{{ table.rows.length }}×{{ table.headers?.length || 0 }}</span>
                  <span class="table-token">[TABLE_{{ table.id }}]</span>
                </div>
                <div class="table-actions">
                  <button 
                    type="button"
                    class="edit-btn"
                    (click)="editTable(table)"
                    title="Edit Table"
                  >
                    ✏️
                  </button>
                  <button 
                    type="button"
                    class="delete-btn"
                    (click)="deleteTable(table)"
                    title="Delete Table"
                  >
                    🗑️
                  </button>
                </div>
              </div>
            </div>
          </details>
        </div>
        <ngx-editor
          [editor]="editor"
          [ngModel]="value"
          (ngModelChange)="onHtmlChange($event)"
          [disabled]="disabled"
          placeholder="Enter your content here..."
        ></ngx-editor>
      </div>
    </div>

    <!-- HTML Source Editor -->
    <div class="editor-panel" *ngIf="showHtmlSource">
      <textarea
        class="html-source-textarea"
        [ngModel]="value"
        (ngModelChange)="onSourceChange($event)"
        [disabled]="disabled"
        placeholder="Enter HTML source code..."
      ></textarea>
    </div>

    <!-- Preview Panel -->
    <div class="preview-panel" *ngIf="showPreview && !showHtmlSource">
      <div class="preview-header">
        <label class="preview-label">Live Preview</label>
      </div>
      <div class="preview-content" [innerHTML]="getSafeHtml()"></div>
    </div>
  </div>

  <!-- Table Editor Modal -->
  <basic-table-editor
    [isOpen]="showTableEditor"
    [tableData]="editingTable"
    (tableCreated)="onTableCreated($event)"
    (modalClosed)="onTableModalClosed()"
  ></basic-table-editor>
</div>
